<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>도착지 비용 계산</title>

  <!-- 폰트: 로그인 페이지와 동일 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>

  <!-- 상단 바 -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="#">
        <img src="https://arrrbang.github.io/pumex/image/pumexlogonew.png" alt="PUMEX Logo" class="brand__logo" />
      </a>
      <a class="header__title" href="#">도착지 비용 계산</a>
      <nav class="header__nav" aria-label="상단 링크"> // 이동할 링크 추가
      </nav>
    </div>
  </header>

  <!-- 메인 -->
  <main class="container section">
    <nav class="tabs" aria-label="카테고리 선택">
      <button class="tab" type="button" id="btnDiplomat">Diplomat</button>
      <button class="tab" type="button" id="btnNonDiplomat">Non-Diplomat</button>
    </nav>
    
<div class="dropdown-container">
  <div class="dropdown" id="dropdownMenu">
    <div class="dropdown-inner">
      <label class="dropdown-label" for="countryCombo">국가 선택</label>
      <div class="combo" id="countryCombo">
        <input type="text" placeholder="국가를 입력/선택 (예: 미국, 중국)" autocomplete="off">
        <div class="list"></div>
      </div>
  
      <div class="dropdown-label-row">
        <span class="label-text">지역 선택</span>
        <button id="btnSelectOnMap" type="button" class="map-button-inline">지도에서 선택</button>

      </div>
      <div class="combo" id="regionCombo">
        <input type="text" placeholder="지역을 입력/선택 (예: A지역, B지역)" autocomplete="off" disabled>
        <div class="list"></div>
      </div>
    </div>
  </div>
</div>
<div class="selection-summary" id="selectionSummary"></div>

<div class="dropdown-container">
  <div class="dropdown" id="nextDropdowns">
    <div class="dropdown-inner">
      <label class="dropdown-label" for="typeCombo">컨테이너 타입</label>
      <div class="combo" id="typeCombo">
        <input type="text" placeholder="20FT / 40HC / CONSOLE" autocomplete="off" value="20FT">
        <div class="list"></div>
      </div>
  
      <label class="dropdown-label" for="cbmSelect">CBM 선택</label>
      <select id="cbmSelect" class="dropdown-select"></select>
    </div>
  </div>
</div>
    
<div class="selection-summary" id="nextSelectionSummary"></div>

<div class="selection-summary" id="thirdSelectionSummary"></div>

<div class="dropdown-container">
  <div class="dropdown" id="thirdDropdowns">
    <div class="dropdown-inner">
      <label class="dropdown-label" for="companyCombo">업체 선택</label>
      <div class="combo" id="companyCombo">
        <input type="text" placeholder="업체를 입력/선택 (예: A업체, B업체)" autocomplete="off" disabled>
        <div class="list"></div>
      </div>

      <label class="dropdown-label" for="poeCombo">POE 선택</label>
      <div class="combo" id="poeCombo">
        <input type="text" placeholder="POE를 입력/선택 (예: DAMMAM, RIYADH DRY PORT)" autocomplete="off" disabled>
        <div class="list"></div>
      </div>
    </div>
  </div>
</div>

<div class="action-row center">
  <button id="btnFetch" class="primary-btn" type="button">조회</button>
</div>

<section id="resultSection" class="result-section">
  <div class="result-container">
    <div id="tableWrap" class="table-wrap"></div>
  </div>
</section>

    
</main>

const BASE = 'https://notion-api-hub.vercel.app'; // 백엔드 베이스(중복 선언 금지)
const $  = (sel, root=document)=> root.querySelector(sel);
const $$ = (sel, root=document)=> Array.from(root.querySelectorAll(sel));
const esc = s => String(s==null?'':s).replace(/[&<>"']/g,m=>({"&":"&amp;","<":"&lt;",">":"&gt;","\"":"&quot;","'":"&#39;"}[m]));
function sleep(ms){ return new Promise(r=>setTimeout(r,ms)); }

/* ----- 1) 요소 참조 ----- */
// 1단
const dropdownMenu      = $('#dropdownMenu');
const selectionSummary  = $('#selectionSummary');
// 2단
const nextDropdowns     = $('#nextDropdowns');
const nextSummary       = $('#nextSelectionSummary');
// 3단
const thirdDropdowns    = $('#thirdDropdowns');
const thirdSummary      = $('#thirdSelectionSummary');

// 콤보/셀렉트
const cbmSelect         = $('#cbmSelect');
const resultSection     = $('#resultSection');
const tableWrap         = $('#tableWrap');
const btnFetch          = $('#btnFetch');

// 탭(외교/비외교)
const btnDip            = $('#btnDiplomat');
const btnNon            = $('#btnNonDiplomat');

// 조회 버튼 래퍼(가운데 배치)
const fetchRow          = document.querySelector('.action-row.center');

// 지도 버튼
const btnSelectOnMap    = $('#btnSelectOnMap');

/* ----- 2) 상태 플래그 ----- */
let isDropdownVisible = false;  // 1단 보임 여부
let isNextVisible     = false;  // 2단 보임 여부
let isThirdVisible    = false;  // 3단 보임 여부
let MAP_MODAL_OPEN    = false;  // 지도 모달 열림 여부

// 결과 금액 포맷 메타
let __numberFormats   = {};

/* ----- 3) 콤보 구현 (간단형) ----- */
function makeCombo(root, preset=[]) {
  const input = $('input', root);
  const list  = $('.list', root);
  let items = Array.isArray(preset)? preset.slice(): [];
  let value = '';

  function render(filter=''){
    const f = filter.trim().toLowerCase();
    const views = items.filter(x => !f || String(x).toLowerCase().includes(f));
    list.innerHTML = views.map(x=>`<div class="opt" data-v="${esc(x)}">${esc(x)}</div>`).join('') || '<div class="opt muted">결과 없음</div>';
  }
  function setItems(arr){
    items = Array.isArray(arr)? arr.slice(): [];
    render(input.value);
  }
  function getValue(){ return value || input.value.trim(); }
  function setValue(v){ value = v||''; input.value = v||''; root.dispatchEvent(new Event('change',{bubbles:true})); }

  // 타이핑 필터
  input.addEventListener('input', ()=> render(input.value));
  // 클릭 선택
  list.addEventListener('click', (e)=>{
    const opt = e.target.closest('.opt'); if(!opt) return;
    const v = opt.getAttribute('data-v') || '';
    value = v; input.value = v;
    root.dispatchEvent(new Event('change', {bubbles:true}));
  });
  // 기본 렌더
  render();

  return { root, input, list, setItems, getValue, setValue };
}

/* ----- 4) 각 콤보 인스턴스 ----- */
const countryCombo = makeCombo($('#countryCombo'));
const regionCombo  = makeCombo($('#regionCombo'));
const companyCombo = makeCombo($('#companyCombo'));
const poeCombo     = makeCombo($('#poeCombo'));
const typeCombo    = makeCombo($('#typeCombo'), ['20FT','40HC','CONSOLE']);

/* ----- 5) 조회 버튼 show/hide ----- */
function showFetch(){ fetchRow?.classList.add('show'); }
function hideFetch(){ fetchRow?.classList.remove('show'); }
hideFetch(); // 처음엔 숨김

/* ----- 6) 컨테이너 열고/닫기 ----- */
function openFirst(){
  dropdownMenu?.classList.add('show');
  isDropdownVisible = true;
  selectionSummary?.classList.remove('show');
}
function closeFirst(){
  dropdownMenu?.classList.remove('show');
  isDropdownVisible = false;
  setTimeout(()=> showFirstSummary(), 380);
  // 1단 닫히면 2단 오픈
  openSecond();
}

function openSecond(){
  nextDropdowns?.classList.add('show');
  isNextVisible = true;
  nextSummary?.classList.remove('show');
  hideFetch(); // 2단 열리면 조회 버튼 숨김
}
function closeSecond(){
  nextDropdowns?.classList.remove('show');
  isNextVisible = false;
  setTimeout(()=>{
    const t   = typeCombo.getValue() || '미선택';
    const cbm = (cbmSelect?.value ? (cbmSelect.options[cbmSelect.selectedIndex]?.text||cbmSelect.value) : '미선택');
    nextSummary.textContent = `${t} — ${cbm}`;
    nextSummary.classList.add('show');
  }, 380);
  // 2단 닫히면 3단 오픈
  openThird();
}

function openThird(){
  thirdDropdowns?.classList.add('show');
  isThirdVisible = true;
  thirdSummary?.classList.remove('show');
  hideFetch(); // 3단 열리면 버튼 숨김
}
function closeThird(){
  thirdDropdowns?.classList.remove('show');
  isThirdVisible = false;
  setTimeout(()=>{
    const comp = (companyCombo.getValue() || '미선택');
    const poe  = (poeCombo.getValue()     || '미선택');
    thirdSummary.textContent = `${comp} — ${poe}`;
    thirdSummary.classList.add('show');
    // ✅ 3단 닫히면 조회 버튼 노출
    showFetch();
  }, 400);
}

/* ----- 7) 1단 요약 갱신 ----- */
function showFirstSummary(){
  const c    = countryCombo.getValue();
  const r    = regionCombo.getValue();
  const comp = companyCombo.getValue();
  if (!selectionSummary) return;
  if (!c && !r && !comp) return; // 전부 비었으면 현재 텍스트 유지
  selectionSummary.textContent = `${c || '미선택'} — ${r || '미선택'} — ${comp || '미선택'}`;
  selectionSummary.classList.add('show');
}

/* ----- 8) 바깥 클릭으로 단계 전환 ----- */
document.addEventListener('pointerdown', (e)=>{
  if (MAP_MODAL_OPEN) return; // 지도 열렸을 땐 외부클릭 무시

  // 1단 바깥
  if (isDropdownVisible){
    const inside = dropdownMenu.contains(e.target);
    if (!inside) closeFirst();
  }
  // 2단 바깥
  else if (isNextVisible){
    const inside2 = nextDropdowns.contains(e.target);
    if (!inside2) closeSecond();
  }
  // 3단 바깥
  else if (isThirdVisible){
    const inside3 = thirdDropdowns.contains(e.target);
    if (!inside3) closeThird();
  }
}, { passive:true });

/* ----- 9) 외교 탭 토글 ----- */
function setTab(active){ // 'dip' | 'non' | null
  btnDip?.classList.toggle('is-active', active==='dip');
  btnNon?.classList.toggle('is-active', active==='non');
}
btnDip?.addEventListener('click', ()=> setTab('dip'));
btnNon?.addEventListener('click', ()=> setTab('non'));

/* ======= 지도(Leaflet) 통합 ======= */
/* ----- 10) 동적 로더 ----- */
function loadCssOnce(href){
  if ([...document.styleSheets].some(s=> s.href && s.href.includes(href))) return Promise.resolve();
  return new Promise((res, rej)=>{
    const link = document.createElement('link');
    link.rel = 'stylesheet'; link.href = href;
    link.onload = ()=> res(); link.onerror = rej;
    document.head.appendChild(link);
  });
}
function loadJsOnce(src){
  if ([...document.scripts].some(s=> s.src && s.src.includes(src))) return Promise.resolve();
  return new Promise((res, rej)=>{
    const sc = document.createElement('script');
    sc.src = src; sc.async = true;
    sc.onload = ()=> res(); sc.onerror = rej;
    document.head.appendChild(sc);
  });
}

/* ----- 11) 지도 전역 ---- */
let LReady = false;
let map, markersLayer, geocoder, pinSearch;
let mapData = null; // ./map.json 로드 결과 { [country]: [{name, lat, lng}] }
let modalEl, modalBack, modalBody, toastEl;

/* ----- 12) 지도 준비 ----- */
async function ensureMapReady(){
  if (!LReady){
    await loadCssOnce('https://unpkg.com/leaflet@1.9.4/dist/leaflet.css');
    await loadJsOnce ('https://unpkg.com/leaflet@1.9.4/dist/leaflet.js');
    await loadCssOnce('https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.css');
    await loadJsOnce ('https://unpkg.com/leaflet-control-geocoder/dist/Control.Geocoder.js');
    LReady = true;
  }
  if (!mapData){
    const r = await fetch('./map.json');
    mapData = await r.json(); // { "대한민국": [{name, lat, lng}, ...], ... }
    window.mapData = mapData; // (원하면 다른 곳에서도 사용)
  }
}

/* ----- 13) 모달 DOM ----- */
function ensureModal(){
  if (modalEl) return;
  modalBack = document.createElement('div');
  modalBack.className = 'map-modal-backdrop';
  modalBack.style.cssText = `
    position:fixed; inset:0; background:rgba(0,0,0,.45); z-index:9998; display:none;
  `;
  modalEl = document.createElement('div');
  modalEl.className = 'map-modal';
  modalEl.style.cssText = `
    position:fixed; inset:10% 8% auto 8%; height:80vh; background:#fff; z-index:9999;
    border-radius:16px; overflow:hidden; display:none; box-shadow:0 10px 30px rgba(0,0,0,.35);
  `;
  modalBody = document.createElement('div');
  modalBody.style.cssText = `position:relative; width:100%; height:100%;`;
  const head = document.createElement('div');
  head.style.cssText = `
    position:absolute; top:0; left:0; right:0; height:48px; display:flex; align-items:center;
    justify-content:space-between; padding:0 12px; background:rgba(0,0,0,.65); color:#fff; z-index:2;
  `;
  head.innerHTML = `
    <strong>지도에서 지역 선택</strong>
    <button type="button" id="btnCloseMap" style="border:none;border-radius:8px;padding:.35rem .6rem;background:#fff;color:#111;cursor:pointer">닫기</button>
  `;
  const mapBox = document.createElement('div');
  mapBox.id = 'mapBox';
  mapBox.style.cssText = `position:absolute; inset:48px 0 0 0;`;

  // 토스트(검은 박스, 화면 높이 1/3 지점 중앙)
  toastEl = document.createElement('div');
  toastEl.className = 'map-toast';
  toastEl.style.cssText = `
    position:absolute; top:33%; left:50%; transform:translate(-50%, -50%);
    background:rgba(0,0,0,.8); color:#fff; padding:.4rem .7rem; border-radius:.6rem;
    font-weight:700; z-index:3; display:none; white-space:nowrap;
  `;

  modalBody.appendChild(head);
  modalBody.appendChild(mapBox);
  modalBody.appendChild(toastEl);
  modalEl.appendChild(modalBody);
  document.body.appendChild(modalBack);
  document.body.appendChild(modalEl);

  // 닫기(배경, 버튼)
  modalBack.addEventListener('click', closeModal);
  $('#btnCloseMap', head)?.addEventListener('click', closeModal);
}

/* ----- 14) 모달 열기/닫기 ----- */
let mapInited = false;
async function openModal(){
  await ensureMapReady();
  ensureModal();

  modalBack.style.display = 'block';
  modalEl.style.display   = 'block';
  MAP_MODAL_OPEN = true;

  if (!mapInited){
    map = L.map('mapBox', { zoomControl: true });
    L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', {
      maxZoom: 19, attribution: '&copy; OpenStreetMap'
    }).addTo(map);

    // 검색(기본 말풍선 억제)
    geocoder = L.Control.geocoder({ defaultMarkGeocode:false })
      .on('markgeocode', onGeocode)
      .addTo(map);

    markersLayer = L.layerGroup().addTo(map);
    pinSearch = L.marker([0,0], { opacity:0 });

    mapInited = true;
  }

  // 현재 국가 기준 마커/뷰 세팅
  setMapCountry(getCountry());
}

function closeModal(){
  modalBack.style.display = 'none';
  modalEl.style.display   = 'none';
  MAP_MODAL_OPEN = false;

  // 닫힐 때 1단 컨테이너 유지(지도 열기 직전 상태로 복귀)
  dropdownMenu?.classList.add('show');
  isDropdownVisible = true;
}

/* ----- 15) 유틸: 현재 국가/지역 읽기 ----- */
function getCountry(){ return countryCombo.getValue(); }
function getRegion(){  return regionCombo.getValue(); }

/* ----- 16) 국가별 마커/뷰 세팅 ----- */
function setMapCountry(country){
  if (!map || !mapData) return;
  markersLayer.clearLayers();

  const pts = Array.isArray(mapData[country]) ? mapData[country] : [];
  if (!pts.length){
    map.setView([20,0], 2);
    return;
  }

  const bounds = [];
  pts.forEach(p=>{
    const mk = L.marker([p.lat, p.lng]).addTo(markersLayer);
    mk.bindTooltip(p.name, { direction:'top', offset:[0,-8] });
    mk.on('click', ()=> {
      setRegionFromMap(p.name);
    });
    bounds.push([p.lat, p.lng]);
  });
  map.fitBounds(bounds, { padding:[40,40] });
}

/* ----- 17) 지도 → 지역 선택 적용 ----- */
function setRegionFromMap(name){
  regionCombo.setValue(name); // change 이벤트까지 발생
  showToast(`지역 선택: ${name}`);
  // 지도 닫고 1단 유지
  closeModal();
}

/* ----- 18) 지오코더 결과 처리(최근접 지역 스냅) ----- */
function onGeocode(e){
  const center = e.geocode && e.geocode.center;
  if (!center) return;
  const lat = center.lat, lng = center.lng;

  // 임시 핀
  if (pinSearch){
    pinSearch.setLatLng([lat,lng]).addTo(map).setOpacity(0.95);
    setTimeout(()=> pinSearch.setOpacity(0), 2500);
  }

  // 현재 국가의 등록 포인트 중 최근접 찾기
  const c = getCountry();
  const pts = Array.isArray(mapData?.[c]) ? mapData[c] : [];
  if (!pts.length) return;

  let best = null, bestD2 = Infinity;
  for (const p of pts){
    const d2 = (p.lat-lat)*(p.lat-lat) + (p.lng-lng)*(p.lng-lng);
    if (d2 < bestD2){ bestD2 = d2; best = p; }
  }
  if (best){
    setRegionFromMap(best.name);
  }else{
    showToast('가까운 등록 지역을 찾지 못했습니다.');
  }
}

/* ----- 19) 토스트 ----- */
let toastTimer = null;
function showToast(msg){
  if (!toastEl) return;
  toastEl.textContent = msg;
  toastEl.style.display = 'block';
  clearTimeout(toastTimer);
  toastTimer = setTimeout(()=> (toastEl.style.display='none'), 2000);
}

/* ----- 20) 지도 버튼 바인딩 ----- */
btnSelectOnMap?.addEventListener('click', openModal);

/* ======= 데이터 로딩 파이프라인 ======= */
// 국가 선택 → 지역 리스트
countryCombo.root.addEventListener('change', async ()=>{
  const country = countryCombo.getValue();

  // 하위 초기화
  regionCombo.setItems([]);   regionCombo.input.disabled  = true;
  companyCombo.setItems([]);  companyCombo.input.disabled = true;
  poeCombo.setItems([]);      poeCombo.input.disabled     = true;

  if (!country) return;
  try{
    const r = await fetch(`${BASE}/api/regions/${encodeURIComponent(country)}`);
    const j = await r.json();
    regionCombo.setItems((j.regions||[]).filter(Boolean));
    regionCombo.input.disabled = (j.regions||[]).length === 0;

    // 지도 열려 있으면 마커 즉시 갱신(선택)
    if (MAP_MODAL_OPEN && mapInited) setMapCountry(country);

    // 1단 자동 오픈(최초 진입 대비)
    if (!isDropdownVisible && !isNextVisible && !isThirdVisible) openFirst();
  }catch(e){
    regionCombo.setItems([]);
    regionCombo.input.disabled = true;
  }
});

// 지역 선택 → 업체 리스트
regionCombo.root.addEventListener('change', async ()=>{
  const country = countryCombo.getValue();
  const region  = regionCombo.getValue();

  companyCombo.setItems([]);  companyCombo.input.disabled = true;
  poeCombo.setItems([]);      poeCombo.input.disabled     = true;

  if (!country || !region) return;

  try{
    const url = `${BASE}/api/companies/by-region?country=${encodeURIComponent(country)}&region=${encodeURIComponent(region)}`;
    const r   = await fetch(url);
    const j   = await r.json();
    const companies = (j.companies || []).filter(Boolean);
    companyCombo.setItems(companies);
    companyCombo.input.disabled = companies.length === 0;
  }catch(e){
    companyCombo.setItems([]); 
    companyCombo.input.disabled = true;
  }
});

// 업체 선택 → (업체+지역) 기준 POE 리스트
companyCombo.root.addEventListener('change', async ()=>{
  const country = countryCombo.getValue();
  const region  = regionCombo.getValue();
  const company = companyCombo.getValue();

  poeCombo.setItems([]);      poeCombo.input.disabled = true;
  if (!country || !region || !company) return;

  try{
    const url = `${BASE}/api/poe/by-company?country=${encodeURIComponent(country)}&region=${encodeURIComponent(region)}&company=${encodeURIComponent(company)}&mode=data`;
    const r   = await fetch(url);
    const j   = await r.json();
    const poes = (j.poes || []).filter(Boolean);
    poeCombo.setItems(poes);
    poeCombo.input.disabled = poes.length === 0;
  }catch(e){
    poeCombo.setItems([]);
    poeCombo.input.disabled = true;
  }
});

/* ======= 결과 표 렌더링 ======= */
function formatAmount(n, columnKey){
  if (n==null || n==='' || isNaN(Number(n))) return '';
  const v = Number(n);
  const fmt = __numberFormats?.[columnKey] || '';
  if (/dollar|usd/i.test(fmt)) return '$' + v.toLocaleString('en-US');
  if (/won|krw/i.test(fmt))    return '₩' + v.toLocaleString('ko-KR');
  if (/euro|eur/i.test(fmt))   return '€' + v.toLocaleString('de-DE');
  return v.toLocaleString();
}

function renderTable(data, type, isRegionFiltered){
  if (!tableWrap){ return; }
  const rows = Array.isArray(data?.rows) ? data.rows : [];
  if (!rows.length){
    tableWrap.innerHTML = '<div class="muted" style="padding:.75rem 0;">표시할 데이터가 없습니다.</div>';
    return;
  }
  let thead = '<tr><th>항목</th>';
  if (!isRegionFiltered) thead += '<th>지역</th>';
  thead += `<th>${esc(type)}</th><th>비고</th></tr>`;

  let tbody = '';
  for (const r of rows){
    const amt = r?.[type];
    const amtText = formatAmount(amt, type) || '-';
    tbody += '<tr>';
    tbody += `<td>${esc(r.item || '')}</td>`;
    if (!isRegionFiltered) tbody += `<td>${esc(r.region || '')}</td>`;
    tbody += `<td class="amt">${amtText}</td>`;
    tbody += `<td>${r.extra || ''}</td>`;
    tbody += '</tr>';
  }
  tableWrap.innerHTML = `
    <table class="result-table">
      <thead>${thead}</thead>
      <tbody>${tbody}</tbody>
    </table>
  `;
}

/* ======= 조회 버튼 → API 호출 + 결과 표시 ======= */
btnFetch?.addEventListener('click', async ()=>{
  try{
    const country = countryCombo.getValue();
    const region  = regionCombo.getValue();
    const company = companyCombo.getValue();
    const type    = typeCombo.getValue() || '20FT';
    const cbm     = cbmSelect?.value ? Number(cbmSelect.value) : undefined;

    if (!country){ alert('국가를 선택하세요.'); return; }
    if (!company){ alert('업체를 선택하세요.'); return; }

    const roles = [];
    if (btnDip?.classList?.contains('is-active')) roles.push('DIPLOMAT');
    if (btnNon?.classList?.contains('is-active')) roles.push('NON-DIPLOMAT');

    const params = new URLSearchParams();
    params.set('type', type);
    params.set('company', company);
    if (region) params.set('region', region);
    if (roles.length) params.set('roles', roles.join(','));
    if (!isNaN(cbm)) params.set('cbm', String(cbm));

    const url = `${BASE}/api/costs/${encodeURIComponent(country)}?${params.toString()}`;
    const res = await fetch(url);
    const j   = await res.json();
    __numberFormats = j?.numberFormats || {};

    renderTable(j, type, Boolean(region));
    resultSection?.classList.add('show');
    resultSection?.scrollIntoView({ behavior:'smooth', block:'start' });
  }catch(e){
    console.error(e);
    alert('조회 중 오류가 발생했습니다.');
  }
});

/* ======= 초기 진입 시 1단 열어두기(필요 시) ======= */
// openFirst(); // 필요하면 주석 해제
</script>

</body>
</html>
