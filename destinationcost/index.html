<!doctype html>
<html lang="ko">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>도착지 비용 계산</title>

  <!-- 폰트: 로그인 페이지와 동일 -->
  <link rel="preconnect" href="https://fonts.googleapis.com">
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
  <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+KR:wght@400;600;700;800&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="./styles.css" />
</head>
<body>
  <div class="page-bg" aria-hidden="true"></div>

  <!-- 상단 바 -->
  <header class="site-header">
    <div class="container header-inner">
      <a class="brand" href="#">
        <img src="https://arrrbang.github.io/pumex/image/pumexlogonew.png" alt="PUMEX Logo" class="brand__logo" />
      </a>
      <a class="header__title" href="#">도착지 비용 계산</a>
      <nav class="header__nav" aria-label="상단 링크"> // 이동할 링크 추가
      </nav>
    </div>
  </header>

  <!-- 메인 -->
  <main class="container section">
    <nav class="tabs" aria-label="카테고리 선택">
      <button class="tab" type="button" id="btnDiplomat">Diplomat</button>
      <button class="tab" type="button" id="btnNonDiplomat">Non-Diplomat</button>
    </nav>
    
  <div class="dropdown-container">
    <div class="dropdown" id="dropdownMenu">

      <label class="dropdown-label" for="countrySelect">국가 선택</label>
      <select id="countrySelect" class="dropdown-select">
      </select>

        <div class="dropdown-label-row">
          <span class="label-text">지역 선택</span>
          <button class="map-button-inline" type="button">지도에서 선택</button>
        </div>
        <select id="regionSelect" class="dropdown-select">
        </select>
      </div>
    </div>
<div class="selection-summary" id="selectionSummary"></div>

<div class="dropdown-container">
  <div class="dropdown" id="nextDropdowns">
    <label class="dropdown-label" for="containerSelect">컨테이너 타입</label>
    <select id="containerSelect" class="dropdown-select">
    </select>

    <label class="dropdown-label" for="cbmSelect">CBM 선택</label>
    <select id="cbmSelect" class="dropdown-select">
    </select>
  </div>
  <div class="selection-summary" id="nextSelectionSummary"></div>
</div>
</main>

<script>
  const btnDiplomat = document.getElementById("btnDiplomat");
  const btnNonDiplomat = document.getElementById("btnNonDiplomat");
  const dropdownMenu = document.getElementById("dropdownMenu"); 
  const summary = document.getElementById("selectionSummary");
  const countrySelect = document.getElementById("countrySelect");
  const regionSelect  = document.getElementById("regionSelect");

  const nextDropdowns = document.getElementById("nextDropdowns");
  const nextSummary   = document.getElementById("nextSelectionSummary");
  const containerSelect = document.getElementById("containerSelect");
  const cbmSelect       = document.getElementById("cbmSelect");

  let isDropdownVisible = false;  // 1단계 열림 여부
  let isNextVisible     = false;  // 2단계 열림 여부

  // 탭 버튼 클릭 시 드롭다운 토글
  function toggleDropdown(button) {
    if (isDropdownVisible) {
      closeDropdown();
    } else {
      dropdownMenu.classList.add("show");
      summary.classList.remove("show");
      nextDropdowns.classList.remove("show");
      nextSummary.classList.remove("show");
      btnDiplomat.classList.remove("is-active");
      btnNonDiplomat.classList.remove("is-active");
      button.classList.add("is-active");
      isDropdownVisible = true;
    }
  }

  function closeDropdown() {
    dropdownMenu.classList.remove("show");
    isDropdownVisible = false;
    // 닫히는 애니메이션 끝난 뒤 1단계 요약 표시 + 0.2s 후 2단계 박스 열기
    setTimeout(() => {
      showFirstSummary();
      openNextDropdowns();
    }, 400);
  }

  // 바깥 클릭 시 닫기
  document.addEventListener("click", (e) => {
    if (!isDropdownVisible) return;
    const clickedInside =
      dropdownMenu.contains(e.target) ||
      btnDiplomat.contains(e.target) ||
      btnNonDiplomat.contains(e.target);
    if (!clickedInside) closeDropdown();
  });

  function showFirstSummary() {
    const c = countrySelect.value
      ? countrySelect.options[countrySelect.selectedIndex].text
      : "미선택";
    const r = regionSelect.value
      ? regionSelect.options[regionSelect.selectedIndex].text
      : "미선택";
    summary.textContent = `${c} - ${r}`;
    summary.classList.add("show");
  }

  function openNextDropdowns() {
    nextDropdowns.classList.add("show");
    nextSummary.classList.remove("show");
    isNextVisible = true;
  }

  function closeNextDropdowns() {
    nextDropdowns.classList.remove("show");
    isNextVisible = false;
    setTimeout(() => {
      const t = containerSelect.value
        ? containerSelect.options[containerSelect.selectedIndex].text
        : "미선택";
      const cbm = cbmSelect.value
        ? cbmSelect.options[cbmSelect.selectedIndex].text
        : "미선택";
      nextSummary.textContent = `${t} - ${cbm}`;
      nextSummary.classList.add("show");
    }, 400);
  }

  document.addEventListener("click", (e) => {
    // 1단계가 열려있고, 클릭이 (박스/버튼) 밖이라면 닫기
    if (isDropdownVisible) {
      const clickedInside1 =
        dropdownMenu.contains(e.target) ||
        btnDiplomat.contains(e.target) ||
        btnNonDiplomat.contains(e.target);
      if (!clickedInside1) {
        closeDropdown();
        return; // 1단계 닫히면 여기서 종료(2단계는 아직 안 열렸거나, 뒤에서 별도 처리)
      }
    }

    // 2단계가 열려있고, 클릭이 2단계 박스 밖이라면 닫기
    if (isNextVisible) {
      const clickedInside2 = nextDropdowns.contains(e.target);
      if (!clickedInside2) {
        closeNextDropdowns();
      }
    }
  });
  
  // 버튼 이벤트
  btnDiplomat.addEventListener("click", () => toggleDropdown(btnDiplomat));
  btnNonDiplomat.addEventListener("click", () => toggleDropdown(btnNonDiplomat));

  // 테스트용 옵션 (임시)
  window.addEventListener("DOMContentLoaded", () => {
    countrySelect.innerHTML = `
      <option value="">국가 선택</option>
      <option value="kr">대한민국</option>
      <option value="jp">일본</option>
      <option value="us">미국</option>
    `;
    regionSelect.innerHTML = `
      <option value="">지역 선택</option>
      <option value="seoul">서울</option>
      <option value="busan">부산</option>
      <option value="tokyo">도쿄</option>
    `;
  });
  
</script>

  
</body>
</html>
